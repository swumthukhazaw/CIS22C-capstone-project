<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Air Travel Database</title>
    <style>
        * { box-sizing: border-box; }

        :root[data-theme="dark"] {
            --bg: #020617;
            --bg-alt: #020617;
            --card: #020617;
            --border: #1f2937;
            --border-soft: #4b5563;
            --accent: #3b82f6;
            --accent-soft: #1d4ed8;
            --accent-text: #f9fafb;
            --text: #e5e7eb;
            --muted: #9ca3af;
            --shadow-soft: 0 8px 24px rgba(0,0,0,0.35);
            --shadow-strong: 0 20px 45px rgba(0,0,0,0.6);
            --particle-color: rgba(148,163,184,0.35);
        }

        :root[data-theme="light"] {
            --bg: #f3f4f6;
            --bg-alt: #ffffff;
            --card: #ffffff;
            --border: #d1d5db;
            --border-soft: #cbd5e1;
            --accent: #2563eb;
            --accent-soft: #1d4ed8;
            --accent-text: #f9fafb;
            --text: #111827;
            --muted: #6b7280;
            --shadow-soft: 0 6px 18px rgba(15,23,42,0.15);
            --shadow-strong: 0 18px 40px rgba(15,23,42,0.25);
            --particle-color: rgba(148,163,184,0.25);
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text);
            transition: background-color 0.25s ease, color 0.25s ease;
            overflow-x: hidden;
        }

        /* Particle background */
        #bgCanvas {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        /* HEADER */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg-alt);
            border-bottom: 1px solid var(--border);
            box-shadow: var(--shadow-soft);
            transition: background-color 0.25s ease, border-color 0.25s ease;
        }
        .app-title-wrap {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .app-title {
            font-size: 20px;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .id-chip {
            font-size: 12px;
            color: var(--muted);
            max-width: 220px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .icon-btn {
            width: 30px;
            height: 30px;
            border-radius: 999px;
            border: 1px solid var(--border-soft);
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition:
              background 0.15s ease,
              transform 0.1s ease,
              border-color 0.15s ease,
              box-shadow 0.15s ease;
            position: relative;
            overflow: hidden;
        }
        .icon-btn span {
            font-size: 16px;
            display: inline-block;
            transition: transform 0.25s ease;
        }
        .icon-btn:hover {
            background: var(--bg-alt);
            border-color: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-soft);
        }
        .icon-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .app-body {
            flex: 1;
            display: flex;
            min-height: 0;
        }

        /* SIDEBAR */
        .sidebar {
            width: 260px;
            background: var(--bg-alt);
            border-right: 1px solid var(--border);
            padding: 18px 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: background-color 0.25s ease, border-color 0.25s ease;
        }
        .sidebar-title {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
            margin-bottom: 6px;
        }
        .menu-btn {
            width: 100%;
            text-align: left;
            padding: 10px 11px;
            border-radius: 10px;
            border: none;
            background: transparent;
            color: var(--text);
            font-size: 14px;
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease, transform 0.1s ease;
            position: relative;
            overflow: hidden;
        }
        .menu-btn span {
            font-size: 12px;
            color: var(--muted);
            display: block;
        }
        .menu-btn:hover {
            background: rgba(59,130,246,0.08);
            transform: translateY(-1px);
        }
        .menu-btn.active {
            background: var(--accent);
            color: var(--accent-text);
        }
        .menu-btn.active span {
            color: #e5e7eb;
        }

        /* MAIN */
        .main {
            flex: 1;
            padding: 22px 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .panel {
            display: none;
            background: var(--card);
            border-radius: 14px;
            padding: 18px 20px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-soft);
            opacity: 0;
            transform: translateY(8px) scale(0.98);
            transition:
              opacity 0.22s ease,
              transform 0.22s ease,
              background-color 0.25s ease,
              border-color 0.25s ease;
        }
        .panel.active {
            display: block;
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        .panel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        .panel-desc {
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 16px;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }
        .form-row label {
            font-size: 14px;
        }
        .input {
            padding: 7px 10px;
            border-radius: 8px;
            border: 1px solid var(--border-soft);
            background: var(--bg);
            color: var(--text);
            min-width: 120px;
            transition: border-color 0.15s ease, background-color 0.25s ease, box-shadow 0.15s ease;
        }
        .input::placeholder {
            color: var(--muted);
        }
        .input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(37,99,235,0.35);
        }
        .btn {
            border: none;
            background: var(--accent);
            color: var(--accent-text);
            padding: 7px 16px;
            border-radius: 999px;
            font-size: 13px;
            cursor: pointer;
            transition:
              background 0.15s ease,
              transform 0.1s ease,
              box-shadow 0.15s ease;
            position: relative;
            overflow: hidden;
        }
        .btn:hover {
            background: var(--accent-soft);
            transform: translateY(-1px);
            box-shadow: var(--shadow-soft);
        }
        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* OUTPUT */
        .output-card {
            margin-top: 10px;
            background: var(--card);
            border-radius: 14px;
            border: 1px solid var(--border);
            padding: 14px 18px;
            box-shadow: var(--shadow-soft);
            transition:
              background-color 0.25s ease,
              border-color 0.25s ease,
              transform 0.2s ease,
              box-shadow 0.2s ease;
        }
        .output-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        .output-title {
            font-size: 14px;
            color: var(--muted);
        }
        #output {
            font-size: 13px;
            max-height: 380px;
            overflow: auto;
        }
        .placeholder {
            color: var(--muted);
        }

        /* Loader (small) */
        .loader {
            width: 18px;
            height: 18px;
            border-radius: 999px;
            border: 2px solid var(--border-soft);
            border-top-color: var(--accent);
            animation: spin 0.8s linear infinite;
            opacity: 0;
            transform: scale(0.5);
            transition: opacity 0.15s ease, transform 0.15s ease;
        }
        .loader.show {
            opacity: 1;
            transform: scale(1);
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px 16px;
            padding: 8px 0;
        }
        .info-item {
            font-size: 13px;
        }
        .info-label {
            color: var(--muted);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }
        .info-value {
            margin-top: 2px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        th, td {
            padding: 6px 8px;
            border-bottom: 1px solid var(--border);
        }
        th {
            text-align: left;
            background: var(--bg-alt);
            color: var(--muted);
            position: sticky;
            top: 0;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        tr:nth-child(even) td { background: var(--card); }
        tr:nth-child(odd)  td { background: var(--card); }

        th.sortable {
            cursor: pointer;
        }
        th.sortable::after {
            content: "";
            margin-left: 4px;
            font-size: 10px;
        }
        th.sortable[data-sort-dir="asc"]::after  { content: "‚ñ≤"; }
        th.sortable[data-sort-dir="desc"]::after { content: "‚ñº"; }

        @media (max-width: 800px) {
            .app-body { flex-direction: column; }
            .sidebar {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
            }
            .menu-btn { white-space: nowrap; }
        }

        /* ID MODAL */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.75);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .modal.show {
            display: flex;
        }
        .modal-card {
            background: var(--card);
            border-radius: 14px;
            padding: 18px 20px;
            border: 1px solid var(--border);
            width: 320px;
            max-width: 90%;
            box-shadow: var(--shadow-strong);
            animation: pop 0.18s ease-out;
        }
        @keyframes pop {
            from { opacity: 0; transform: translateY(6px) scale(0.97); }
            to   { opacity: 1; transform: translateY(0) scale(1); }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .modal-title {
            font-size: 15px;
            font-weight: 600;
        }
        .modal-close {
            border: none;
            background: transparent;
            color: var(--muted);
            font-size: 18px;
            cursor: pointer;
        }
        .modal-body {
            font-size: 13px;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 40;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease;
            backdrop-filter: blur(3px);
        }
        .loading-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        .loading-overlay-inner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: var(--muted);
            font-size: 13px;
        }
        .loading-overlay-spinner {
            width: 28px;
            height: 28px;
            border-radius: 999px;
            border: 3px solid rgba(148,163,184,0.5);
            border-top-color: var(--accent);
            animation: spin 0.9s linear infinite;
        }

        /* Ripple effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.45s linear;
            background: rgba(255,255,255,0.35);
            pointer-events: none;
        }
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Toast notifications */
        #toastContainer {
            position: fixed;
            bottom: 16px;
            right: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 60;
        }
        .toast {
            min-width: 200px;
            max-width: 320px;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 12px;
            box-shadow: var(--shadow-soft);
            background: var(--card);
            border: 1px solid var(--border-soft);
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast-message {
            flex: 1;
        }
        .toast-close {
            border: none;
            background: transparent;
            color: var(--muted);
            cursor: pointer;
            font-size: 14px;
        }
        .toast-success {
            border-color: rgba(34,197,94,0.5);
        }
        .toast-error {
            border-color: rgba(248,113,113,0.7);
        }

        /* One-hop SVG */
        .onehop-graph {
            margin: 8px 0 10px;
        }

        /* Admin panel sections */
        .admin-section-title {
            font-size: 14px;
            font-weight: 600;
            margin-top: 6px;
            margin-bottom: 4px;
        }
        .admin-note {
            font-size: 11px;
            color: var(--muted);
            margin-bottom: 8px;
        }
        .admin-divider {
            margin: 8px 0;
            height: 1px;
            background: var(--border);
        }
    </style>
</head>
<body>
<canvas id="bgCanvas"></canvas>

<div class="app">
    <!-- HEADER -->
    <header class="app-header">
        <div class="app-title-wrap">
            <div class="app-title">‚úàÔ∏è Air Travel Database</div>
        </div>
        <div class="header-right">
            <div id="headerIdText" class="id-chip"></div>
            <button class="icon-btn" onclick="toggleTheme()" title="Toggle light/dark">
                <span id="themeIcon">üåô</span>
            </button>
            <button class="icon-btn" onclick="loadId()" title="Show my ID">
                <span>üë§</span>
            </button>
        </div>
    </header>

    <div class="app-body">
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="sidebar-title">Menu</div>

            <button class="menu-btn active" data-panel="airline">
                Lookup Airline
                <span>Find airline by IATA code</span>
            </button>

            <button class="menu-btn" data-panel="airport">
                Lookup Airport
                <span>Find airport by IATA code</span>
            </button>

            <button class="menu-btn" data-panel="airline-routes">
                Airline Route Report
                <span>Airports served by an airline</span>
            </button>

            <button class="menu-btn" data-panel="airport-routes">
                Airport Route Report
                <span>Airlines serving an airport</span>
            </button>

            <button class="menu-btn" data-panel="one-hop">
                One-Hop Routes
                <span>Find S ‚Üí X ‚Üí D (0 stops)</span>
            </button>

            <button class="menu-btn" data-panel="all-airlines">
                All Airlines
                <span>Sorted by IATA</span>
            </button>

            <button class="menu-btn" data-panel="all-airports">
                All Airports
                <span>Sorted by IATA</span>
            </button>

            <button class="menu-btn" data-panel="admin">
                Admin / Data Editor
                <span>Modify in-memory data</span>
            </button>
        </nav>

        <!-- MAIN -->
        <main class="main">
            <!-- PANELS -->
            <section id="panel-airline" class="panel active">
                <div class="panel-title">Lookup Airline</div>
                <div class="panel-desc">
                    Enter a 2‚Äì3 letter IATA airline code (for example: <code>AA</code>, <code>UA</code>, <code>DL</code>).
                </div>
                <div class="form-row">
                    <label for="airlineInput">Airline IATA:</label>
                    <input id="airlineInput" class="input iata-input" maxlength="3" list="airlineList" placeholder="AA">
                    <button class="btn" onclick="lookupAirline()">Search</button>
                </div>
            </section>

            <section id="panel-airport" class="panel">
                <div class="panel-title">Lookup Airport</div>
                <div class="panel-desc">
                    Enter a 3-letter airport IATA code (for example: <code>SFO</code>, <code>LAX</code>, <code>JFK</code>).
                </div>
                <div class="form-row">
                    <label for="airportInput">Airport IATA:</label>
                    <input id="airportInput" class="input iata-input" maxlength="3" list="airportList" placeholder="SFO">
                    <button class="btn" onclick="lookupAirport()">Search</button>
                </div>
            </section>

            <section id="panel-airline-routes" class="panel">
                <div class="panel-title">Airline Route Report</div>
                <div class="panel-desc">
                    Shows all airports served by a given airline, with a count of routes to/from each airport.
                </div>
                <div class="form-row">
                    <label for="airlineRouteInput">Airline IATA:</label>
                    <input id="airlineRouteInput" class="input iata-input" maxlength="3" list="airlineList" placeholder="AA">
                    <button class="btn" onclick="airlineRoutes()">Generate</button>
                </div>
            </section>

            <section id="panel-airport-routes" class="panel">
                <div class="panel-title">Airport Route Report</div>
                <div class="panel-desc">
                    Shows all airlines that serve a given airport, with a count of routes involving that airport.
                </div>
                <div class="form-row">
                    <label for="airportRouteInput">Airport IATA:</label>
                    <input id="airportRouteInput" class="input iata-input" maxlength="3" list="airportList" placeholder="SFO">
                    <button class="btn" onclick="airportRoutes()">Generate</button>
                </div>
            </section>

            <section id="panel-one-hop" class="panel">
                <div class="panel-title">One-Hop Route Finder</div>
                <div class="panel-desc">
                    Find all <strong>one-hop</strong> routes from a source airport to a destination airport:
                    S ‚Üí X ‚Üí D, where each leg has 0 stops. Results are ordered by total air miles.
                </div>
                <div class="form-row">
                    <label for="oneHopSrcInput">Source IATA:</label>
                    <input id="oneHopSrcInput" class="input iata-input" maxlength="3" list="airportList" placeholder="SFO">
                    <label for="oneHopDstInput">Destination IATA:</label>
                    <input id="oneHopDstInput" class="input iata-input" maxlength="3" list="airportList" placeholder="JFK">
                    <button class="btn" onclick="oneHop()">Find Routes</button>
                </div>
            </section>

            <section id="panel-all-airlines" class="panel">
                <div class="panel-title">All Airlines</div>
                <div class="panel-desc">
                    Returns the list of all airlines sorted by IATA code.
                </div>
                <button class="btn" onclick="allAirlines()">Load Airlines</button>
            </section>

            <section id="panel-all-airports" class="panel">
                <div class="panel-title">All Airports</div>
                <div class="panel-desc">
                    Returns the list of all airports sorted by IATA code.
                </div>
                <button class="btn" onclick="allAirports()">Load Airports</button>
            </section>

            <!-- ADMIN PANEL -->
            <section id="panel-admin" class="panel">
                <div class="panel-title">Admin / Data Editor</div>
                <div class="panel-desc">
                    Modify the in-memory contents of airlines, airports, and routes using the C++ update endpoints.
                    Changes are not written back to the <code>.dat</code> files.
                </div>

                <!-- Airline section -->
                <div class="admin-section-title">Airline ‚Äì Add</div>
                <div class="admin-note">
                    Required: <code>id</code>, <code>iata</code>, <code>name</code>. Country and Active are optional.
                </div>
                <div class="form-row">
                    <label for="adminAirlineAddId">ID:</label>
                    <input id="adminAirlineAddId" class="input" type="number" placeholder="12345">
                    <label for="adminAirlineAddIata">IATA:</label>
                    <input id="adminAirlineAddIata" class="input iata-input" maxlength="3" placeholder="ZZ">
                    <label for="adminAirlineAddName">Name:</label>
                    <input id="adminAirlineAddName" class="input" placeholder="Test Airline">
                </div>
                <div class="form-row">
                    <label for="adminAirlineAddCountry">Country:</label>
                    <input id="adminAirlineAddCountry" class="input" placeholder="Nowhere">
                    <label>
                        <input id="adminAirlineAddActive" type="checkbox" checked>
                        Active
                    </label>
                    <button class="btn" onclick="adminAirlineAdd()">Add Airline</button>
                </div>

                <div class="admin-divider"></div>

                <div class="admin-section-title">Airline ‚Äì Update</div>
                <div class="admin-note">
                    Required: <code>id</code>. Any other field you fill in will be updated.
                </div>
                <div class="form-row">
                    <label for="adminAirlineUpdateId">ID:</label>
                    <input id="adminAirlineUpdateId" class="input" type="number" placeholder="12345">
                    <label for="adminAirlineUpdateIata">IATA:</label>
                    <input id="adminAirlineUpdateIata" class="input iata-input" maxlength="3" placeholder="ZZ">
                    <label for="adminAirlineUpdateName">Name:</label>
                    <input id="adminAirlineUpdateName" class="input" placeholder="New Name">
                </div>
                <div class="form-row">
                    <label for="adminAirlineUpdateCountry">Country:</label>
                    <input id="adminAirlineUpdateCountry" class="input" placeholder="New Country">
                    <label>
                        <input id="adminAirlineUpdateActive" type="checkbox">
                        Active (tick to set true)
                    </label>
                    <button class="btn" onclick="adminAirlineUpdate()">Update Airline</button>
                </div>

                <div class="admin-divider"></div>

                <!-- Airport section -->
                <div class="admin-section-title">Airport ‚Äì Add</div>
                <div class="admin-note">
                    Required: <code>id</code>, <code>iata</code>, <code>name</code>. Others are optional.
                </div>
                <div class="form-row">
                    <label for="adminAirportAddId">ID:</label>
                    <input id="adminAirportAddId" class="input" type="number" placeholder="9999">
                    <label for="adminAirportAddIata">IATA:</label>
                    <input id="adminAirportAddIata" class="input iata-input" maxlength="3" placeholder="ZZZ">
                    <label for="adminAirportAddName">Name:</label>
                    <input id="adminAirportAddName" class="input" placeholder="Test Airport">
                </div>
                <div class="form-row">
                    <label for="adminAirportAddCity">City:</label>
                    <input id="adminAirportAddCity" class="input" placeholder="Test City">
                    <label for="adminAirportAddCountry">Country:</label>
                    <input id="adminAirportAddCountry" class="input" placeholder="TC">
                </div>
                <div class="form-row">
                    <label for="adminAirportAddLat">Lat:</label>
                    <input id="adminAirportAddLat" class="input" type="number" step="0.0001" placeholder="37.0">
                    <label for="adminAirportAddLon">Lon:</label>
                    <input id="adminAirportAddLon" class="input" type="number" step="0.0001" placeholder="-122.0">
                    <button class="btn" onclick="adminAirportAdd()">Add Airport</button>
                </div>

                <div class="admin-divider"></div>

                <div class="admin-section-title">Airport ‚Äì Update</div>
                <div class="admin-note">
                    Required: <code>id</code>. Any other field you fill in will be updated.
                </div>
                <div class="form-row">
                    <label for="adminAirportUpdateId">ID:</label>
                    <input id="adminAirportUpdateId" class="input" type="number" placeholder="9999">
                    <label for="adminAirportUpdateIata">IATA:</label>
                    <input id="adminAirportUpdateIata" class="input iata-input" maxlength="3" placeholder="ZZZ">
                    <label for="adminAirportUpdateName">Name:</label>
                    <input id="adminAirportUpdateName" class="input" placeholder="New Airport Name">
                </div>
                <div class="form-row">
                    <label for="adminAirportUpdateCity">City:</label>
                    <input id="adminAirportUpdateCity" class="input" placeholder="New City">
                    <label for="adminAirportUpdateCountry">Country:</label>
                    <input id="adminAirportUpdateCountry" class="input" placeholder="New Country">
                </div>
                <div class="form-row">
                    <label for="adminAirportUpdateLat">Lat:</label>
                    <input id="adminAirportUpdateLat" class="input" type="number" step="0.0001" placeholder="">
                    <label for="adminAirportUpdateLon">Lon:</label>
                    <input id="adminAirportUpdateLon" class="input" type="number" step="0.0001" placeholder="">
                    <button class="btn" onclick="adminAirportUpdate()">Update Airport</button>
                </div>

                <div class="admin-divider"></div>

                <!-- Route section -->
                <div class="admin-section-title">Route ‚Äì Add</div>
                <div class="admin-note">
                    Required: <code>airline_id</code>, <code>src_id</code>, <code>dst_id</code>. Stops defaults to 0.
                </div>
                <div class="form-row">
                    <label for="adminRouteAddAirlineId">Airline ID:</label>
                    <input id="adminRouteAddAirlineId" class="input" type="number" placeholder="99999">
                    <label for="adminRouteAddSrcId">Source ID:</label>
                    <input id="adminRouteAddSrcId" class="input" type="number" placeholder="9999">
                    <label for="adminRouteAddDstId">Dest ID:</label>
                    <input id="adminRouteAddDstId" class="input" type="number" placeholder="1">
                </div>
                <div class="form-row">
                    <label for="adminRouteAddStops">Stops:</label>
                    <input id="adminRouteAddStops" class="input" type="number" placeholder="0">
                    <button class="btn" onclick="adminRouteAdd()">Add Route</button>
                </div>

            </section>

            <!-- OUTPUT -->
            <section class="output-card tilt-card">
                <div class="output-header">
                    <div class="output-title" id="outputTitle">Result</div>
                    <div id="loader" class="loader"></div>
                </div>
                <div id="output" class="placeholder"></div>
            </section>
        </main>
    </div>
</div>

<!-- ID POPUP MODAL -->
<div id="idModal" class="modal" onclick="onModalBackgroundClick(event)">
    <div class="modal-card">
        <div class="modal-header">
            <div class="modal-title">My ID</div>
            <button class="modal-close" onclick="hideIdModal()" aria-label="Close">√ó</button>
        </div>
        <div id="idModalBody" class="modal-body">
            Loading...
        </div>
    </div>
</div>

<!-- Loading overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-overlay-inner">
        <div class="loading-overlay-spinner"></div>
        <div>Fetching data from C++ backend‚Ä¶</div>
    </div>
</div>

<!-- Toast container -->
<div id="toastContainer"></div>

<!-- Autocomplete lists -->
<datalist id="airlineList"></datalist>
<datalist id="airportList"></datalist>

<script>
/* ---------- THEME ---------- */
let currentTheme = 'dark';

function applyTheme(theme) {
    currentTheme = theme;
    document.documentElement.setAttribute('data-theme', theme);
    const icon = document.getElementById('themeIcon');
    icon.style.transform = 'rotate(180deg)';
    setTimeout(() => { icon.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è'; icon.style.transform = 'rotate(0deg)'; }, 120);
}

function toggleTheme() {
    applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
}

/* ---------- PARTICLE BACKGROUND ---------- */
function initParticles() {
    const canvas = document.getElementById('bgCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    const particles = [];
    const count = 60;
    for (let i = 0; i < count; i++) {
        particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            r: Math.random() * 1.2 + 0.4,
            dx: (Math.random() - 0.5) * 0.15,
            dy: (Math.random() - 0.5) * 0.15
        });
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const color = getComputedStyle(document.documentElement).getPropertyValue('--particle-color').trim() || 'rgba(148,163,184,0.3)';
        ctx.fillStyle = color;
        for (const p of particles) {
            p.x += p.dx;
            p.y += p.dy;
            if (p.x < 0) p.x = canvas.width;
            if (p.x > canvas.width) p.x = 0;
            if (p.y < 0) p.y = canvas.height;
            if (p.y > canvas.height) p.y = 0;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fill();
        }
        requestAnimationFrame(animate);
    }
    animate();
}

/* ---------- TOASTS ---------- */
function showToast(message, type) {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = 'toast ' + (type === 'error' ? 'toast-error' : 'toast-success');

    const msgDiv = document.createElement('div');
    msgDiv.className = 'toast-message';
    msgDiv.textContent = message;

    const closeBtn = document.createElement('button');
    closeBtn.className = 'toast-close';
    closeBtn.textContent = '√ó';
    closeBtn.onclick = () => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 200);
    };

    toast.appendChild(msgDiv);
    toast.appendChild(closeBtn);
    container.appendChild(toast);

    requestAnimationFrame(() => toast.classList.add('show'));
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 200);
    }, 3500);
}

/* ---------- LOADER ---------- */
function setLoading(isLoading) {
    const loader = document.getElementById('loader');
    const overlay = document.getElementById('loadingOverlay');
    if (!loader || !overlay) return;
    if (isLoading) {
        loader.classList.add('show');
        overlay.classList.add('show');
    } else {
        loader.classList.remove('show');
        overlay.classList.remove('show');
    }
}

/* ---------- HELPERS ---------- */
function setOutput(html, title) {
    if (title) document.getElementById("outputTitle").innerText = title;
    const out = document.getElementById("output");
    out.classList.remove("placeholder");
    out.innerHTML = html;
    enableTableSorting();
}
function setError(err) {
    const msg = (err && err.message) ? err.message : String(err);
    document.getElementById("outputTitle").innerText = "Error";
    const out = document.getElementById("output");
    out.classList.remove("placeholder");
    out.textContent = msg;
    setLoading(false);
    showToast(msg, 'error');
}
function api(path) {
    return fetch(path).then(res => {
        if (!res.ok) {
            return res.text().then(t => { throw new Error(t || ("HTTP " + res.status)); });
        }
        return res.json();
    });
}
function apiPost(path, payload) {
    return fetch(path, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    }).then(res => {
        if (!res.ok) {
            return res.text().then(t => { throw new Error(t || ("HTTP " + res.status)); });
        }
        return res.json();
    });
}

/* ---------- ID POPUP ---------- */
function showIdModal() {
    document.getElementById("idModal").classList.add("show");
}
function hideIdModal() {
    document.getElementById("idModal").classList.remove("show");
}
function onModalBackgroundClick(event) {
    if (event.target.id === "idModal") hideIdModal();
}
function renderIdInModal(data) {
    const name = data.name || "";
    const id = data.deanza_id || data.id || "";
    const chip = document.getElementById("headerIdText");
    chip.textContent = name && id ? `${name} (${id})` : "";

    const html = `
      <div class="modal-body">
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">Name</div>
            <div class="info-value">${name}</div>
          </div>
          <div class="info-item">
            <div class="info-label">De Anza ID</div>
            <div class="info-value">${id}</div>
          </div>
        </div>
        <p style="font-size:13px;color:var(--muted);margin-top:8px;">
          This ID is returned directly from the C++ backend via the
          <code>/id</code> endpoint for the CIS 22C Honors project.
        </p>
      </div>
    `;
    document.getElementById("idModalBody").innerHTML = html;
}
function loadId() {
    document.getElementById("idModalBody").textContent = "Loading...";
    showIdModal();
    api('/id')
        .then(data => { renderIdInModal(data); showToast("ID loaded from backend.", "success"); })
        .catch(err => {
            document.getElementById("idModalBody").textContent = "Error: " + err.message;
            showToast(err.message, "error");
        });
}

/* ---------- TABLE SORTING ---------- */
function enableTableSorting() {
    document.querySelectorAll('#output table.sortable').forEach(table => {
        const thead = table.tHead;
        if (!thead) return;
        Array.from(thead.rows[0].cells).forEach((th, index) => {
            th.classList.add('sortable');
            th.onclick = () => {
                const dir = th.dataset.sortDir === 'asc' ? 'desc' : 'asc';
                th.dataset.sortDir = dir;
                Array.from(th.parentElement.cells).forEach(other => {
                    if (other !== th) other.removeAttribute('data-sort-dir');
                });
                sortTableByColumn(table, index, dir === 'asc');
            };
        });
    });
}
function sortTableByColumn(table, columnIndex, asc = true) {
    const tbody = table.tBodies[0];
    const rows = Array.from(tbody.rows);
    rows.sort((a, b) => {
        const A = a.cells[columnIndex].innerText.trim();
        const B = b.cells[columnIndex].innerText.trim();
        const numA = parseFloat(A), numB = parseFloat(B);
        if (!isNaN(numA) && !isNaN(numB)) {
            return asc ? numA - numB : numB - numA;
        }
        return asc ? A.localeCompare(B) : B.localeCompare(A);
    });
    rows.forEach(r => tbody.appendChild(r));
}

/* ---------- RENDERERS ---------- */
function renderAirline(data, code) {
    const html = `
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Name</div>
          <div class="info-value">${data.name || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">IATA</div>
          <div class="info-value">${data.iata || code || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Country</div>
          <div class="info-value">${data.country || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Active</div>
          <div class="info-value">${String(data.active)}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Internal ID</div>
          <div class="info-value">${data.id}</div>
        </div>
      </div>
    `;
    setOutput(html, `Airline: ${data.iata || code}`);
    showToast(`Loaded airline ${data.iata || code}`, "success");
}
function renderAirport(data, code) {
    const html = `
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Name</div>
          <div class="info-value">${data.name || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">IATA</div>
          <div class="info-value">${data.iata || code || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">City</div>
          <div class="info-value">${data.city || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Country</div>
          <div class="info-value">${data.country || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Latitude</div>
          <div class="info-value">${data.latitude}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Longitude</div>
          <div class="info-value">${data.longitude}</div>
        </div>
      </div>
    `;
    setOutput(html, `Airport: ${data.iata || code}`);
    showToast(`Loaded airport ${data.iata || code}`, "success");
}
function renderTable(headers, rows) {
    let thead = "<tr>";
    headers.forEach(h => thead += `<th>${h}</th>`);
    thead += "</tr>";
    let tbody = "";
    rows.forEach(r => {
        tbody += "<tr>";
        r.forEach(cell => { tbody += `<td>${cell}</td>`; });
        tbody += "</tr>";
    });
    return `<div style="max-height:340px;overflow:auto;"><table class="sortable">${thead}${tbody}</table></div>`;
}
function renderAirlineRoutes(data, code) {
    const airline = data.airline || {};
    const list = data.airports || [];
    const rows = list.map(a => [
        a.iata || "",
        a.name || "",
        a.city || "",
        a.country || "",
        a.route_count
    ]);
    const table = renderTable(
        ["Airport IATA", "Name", "City", "Country", "# Routes"],
        rows
    );
    const titleHtml = `
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Airline</div>
          <div class="info-value">${airline.name || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">IATA</div>
          <div class="info-value">${airline.iata || code || ""}</div>
        </div>
      </div>
    `;
    setOutput(titleHtml + table, `Airline Route Report: ${airline.iata || code}`);
    showToast(`Loaded airline route report for ${airline.iata || code}`, "success");
}
function renderAirportRoutes(data, code) {
    const airport = data.airport || {};
    const list = data.airlines || [];
    const rows = list.map(a => [
        a.iata || "",
        a.name || "",
        a.country || "",
        a.route_count
    ]);
    const table = renderTable(
        ["Airline IATA", "Name", "Country", "# Routes"],
        rows
    );
    const titleHtml = `
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Airport</div>
          <div class="info-value">${airport.name || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">IATA</div>
          <div class="info-value">${airport.iata || code || ""}</div>
        </div>
        <div class="info-item">
          <div class="info-label">City / Country</div>
          <div class="info-value">${airport.city || ""} ${airport.country ? " / " + airport.country : ""}</div>
        </div>
      </div>
    `;
    setOutput(titleHtml + table, `Airport Route Report: ${airport.iata || code}`);
    showToast(`Loaded airport route report for ${airport.iata || code}`, "success");
}
function renderAirlinesList(data) {
    const list = data.airlines || [];
    const rows = list.map(a => [
        a.iata || "",
        a.name || "",
        a.country || "",
        String(a.active)
    ]);
    const table = renderTable(
        ["IATA", "Name", "Country", "Active"],
        rows
    );
    setOutput(table, "All Airlines (sorted by IATA)");
    showToast(`Loaded ${list.length} airlines.`, "success");
}
function renderAirportsList(data) {
    const list = data.airports || [];
    const rows = list.map(a => [
        a.iata || "",
        a.name || "",
        a.city || "",
        a.country || ""
    ]);
    const table = renderTable(
        ["IATA", "Name", "City", "Country"],
        rows
    );
    setOutput(table, "All Airports (sorted by IATA)");
    showToast(`Loaded ${list.length} airports.`, "success");
}
function renderOneHop(data, src, dst) {
    const routes = data.routes || [];
    if (!routes.length) {
        setOutput(
            `<p>No one-hop routes found from <strong>${src}</strong> to <strong>${dst}</strong> with 0 stops on each leg.</p>`,
            `One-Hop Routes: ${src} ‚Üí ${dst}`
        );
        showToast(`No one-hop routes found for ${src} ‚Üí ${dst}`, "error");
        return;
    }

    const rows = routes.map(r => [
        (r.via && r.via.iata) || "",
        (r.via && r.via.name) || "",
        r.total_miles ? r.total_miles.toFixed(1) : "",
        r.airline1 && r.airline1.iata ? r.airline1.iata : "",
        r.airline2 && r.airline2.iata ? r.airline2.iata : ""
    ]);

    const table = renderTable(
        ["Via IATA", "Via Name", "Total Miles", "Airline 1", "Airline 2"],
        rows
    );

    const header = `
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Source</div>
          <div class="info-value">${(data.source && data.source.iata) || src}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Destination</div>
          <div class="info-value">${(data.destination && data.destination.iata) || dst}</div>
        </div>
      </div>
    `;

    // Simple SVG mini graph using first via node
    const first = routes[0];
    const viaLabel = (first.via && first.via.iata) || "X";
    const srcLabel = (data.source && data.source.iata) || src;
    const dstLabel = (data.destination && data.destination.iata) || dst;
    const graph = `
      <div class="onehop-graph">
        <svg width="100%" height="80" viewBox="0 0 260 80">
          <line x1="30" y1="40" x2="130" y2="40" stroke="var(--border-soft)" stroke-width="1.5" />
          <line x1="130" y1="40" x2="230" y2="40" stroke="var(--border-soft)" stroke-width="1.5" />
          <circle cx="30" cy="40" r="6" fill="var(--accent)" />
          <circle cx="130" cy="40" r="6" fill="var(--accent)" />
          <circle cx="230" cy="40" r="6" fill="var(--accent)" />
          <text x="30" y="62" text-anchor="middle" font-size="11" fill="var(--muted)">${srcLabel}</text>
          <text x="130" y="62" text-anchor="middle" font-size="11" fill="var(--muted)">${viaLabel}</text>
          <text x="230" y="62" text-anchor="middle" font-size="11" fill="var(--muted)">${dstLabel}</text>
        </svg>
      </div>
    `;

    setOutput(header + graph + table, `One-Hop Routes: ${src} ‚Üí ${dst}`);
    showToast(`Found ${routes.length} one-hop routes for ${src} ‚Üí ${dst}`, "success");
}

/* ---------- API CALLS (with spinner) ---------- */
function lookupAirline() {
    const code = document.getElementById("airlineInput").value.trim();
    if (!code) {
        setError(new Error("Please enter an airline IATA code."));
        return;
    }
    setLoading(true);
    api(`/airline?iata=${encodeURIComponent(code)}`)
        .then(data => renderAirline(data, code))
        .catch(setError)
        .finally(() => setLoading(false));
}
function lookupAirport() {
    const code = document.getElementById("airportInput").value.trim();
    if (!code) {
        setError(new Error("Please enter an airport IATA code."));
        return;
    }
    setLoading(true);
    api(`/airport?iata=${encodeURIComponent(code)}`)
        .then(data => renderAirport(data, code))
        .catch(setError)
        .finally(() => setLoading(false));
}
function airlineRoutes() {
    const code = document.getElementById("airlineRouteInput").value.trim();
    if (!code) {
        setError(new Error("Please enter an airline IATA code."));
        return;
    }
    setLoading(true);
    api(`/airline-routes?iata=${encodeURIComponent(code)}`)
        .then(data => renderAirlineRoutes(data, code))
        .catch(setError)
        .finally(() => setLoading(false));
}
function airportRoutes() {
    const code = document.getElementById("airportRouteInput").value.trim();
    if (!code) {
        setError(new Error("Please enter an airport IATA code."));
        return;
    }
    setLoading(true);
    api(`/airport-routes?iata=${encodeURIComponent(code)}`)
        .then(data => renderAirportRoutes(data, code))
        .catch(setError)
        .finally(() => setLoading(false));
}
function oneHop() {
    const src = document.getElementById("oneHopSrcInput").value.trim();
    const dst = document.getElementById("oneHopDstInput").value.trim();
    if (!src || !dst) {
        setError(new Error("Please enter both source and destination IATA codes."));
        return;
    }
    setLoading(true);
    api(`/one-hop?src=${encodeURIComponent(src)}&dst=${encodeURIComponent(dst)}`)
        .then(data => renderOneHop(data, src, dst))
        .catch(setError)
        .finally(() => setLoading(false));
}
function allAirlines() {
    setLoading(true);
    api('/airlines-by-iata')
        .then(renderAirlinesList)
        .catch(setError)
        .finally(() => setLoading(false));
}
function allAirports() {
    setLoading(true);
    api('/airports-by-iata')
        .then(renderAirportsList)
        .catch(setError)
        .finally(() => setLoading(false));
}

/* ---------- ADMIN CALLS ---------- */
function adminAirlineAdd() {
    const id = parseInt(document.getElementById("adminAirlineAddId").value, 10);
    const iata = document.getElementById("adminAirlineAddIata").value.trim();
    const name = document.getElementById("adminAirlineAddName").value.trim();
    const country = document.getElementById("adminAirlineAddCountry").value.trim();
    const active = document.getElementById("adminAirlineAddActive").checked;

    if (!id || !iata || !name) {
        setError(new Error("Airline Add: id, iata, and name are required."));
        return;
    }
    setLoading(true);
    apiPost('/airline-add', {
        id: id,
        iata: iata,
        name: name,
        country: country,
        active: active
    })
    .then(resp => {
        showToast(resp.message || "Airline added.", "success");
        setOutput(
            `<p>Airline added: <strong>${resp.airline.iata}</strong> ‚Äî ${resp.airline.name}</p>`,
            "Admin: Airline Add"
        );
        preloadIataLists();
    })
    .catch(setError)
    .finally(() => setLoading(false));
}

function adminAirlineUpdate() {
    const id = parseInt(document.getElementById("adminAirlineUpdateId").value, 10);
    if (!id) {
        setError(new Error("Airline Update: id is required."));
        return;
    }
    const iata = document.getElementById("adminAirlineUpdateIata").value.trim();
    const name = document.getElementById("adminAirlineUpdateName").value.trim();
    const country = document.getElementById("adminAirlineUpdateCountry").value.trim();
    const activeChecked = document.getElementById("adminAirlineUpdateActive").checked;

    const payload = { id: id };
    if (iata) payload.iata = iata;
    if (name) payload.name = name;
    if (country) payload.country = country;
    if (activeChecked) payload.active = true; // only set true (we keep it simple)

    setLoading(true);
    apiPost('/airline-update', payload)
        .then(resp => {
            showToast(resp.message || "Airline updated.", "success");
            setOutput(
                `<p>Airline updated: <strong>${resp.airline.iata}</strong> ‚Äî ${resp.airline.name}</p>`,
                "Admin: Airline Update"
            );
            preloadIataLists();
        })
        .catch(setError)
        .finally(() => setLoading(false));
}

function adminAirportAdd() {
    const id = parseInt(document.getElementById("adminAirportAddId").value, 10);
    const iata = document.getElementById("adminAirportAddIata").value.trim();
    const name = document.getElementById("adminAirportAddName").value.trim();
    const city = document.getElementById("adminAirportAddCity").value.trim();
    const country = document.getElementById("adminAirportAddCountry").value.trim();
    const latVal = document.getElementById("adminAirportAddLat").value;
    const lonVal = document.getElementById("adminAirportAddLon").value;
    const lat = latVal ? parseFloat(latVal) : 0.0;
    const lon = lonVal ? parseFloat(lonVal) : 0.0;

    if (!id || !iata || !name) {
        setError(new Error("Airport Add: id, iata, and name are required."));
        return;
    }
    setLoading(true);
    apiPost('/airport-add', {
        id: id,
        iata: iata,
        name: name,
        city: city,
        country: country,
        latitude: lat,
        longitude: lon
    })
    .then(resp => {
        showToast(resp.message || "Airport added.", "success");
        setOutput(
            `<p>Airport added: <strong>${resp.airport.iata}</strong> ‚Äî ${resp.airport.name}</p>`,
            "Admin: Airport Add"
        );
        preloadIataLists();
    })
    .catch(setError)
    .finally(() => setLoading(false));
}

function adminAirportUpdate() {
    const id = parseInt(document.getElementById("adminAirportUpdateId").value, 10);
    if (!id) {
        setError(new Error("Airport Update: id is required."));
        return;
    }
    const iata = document.getElementById("adminAirportUpdateIata").value.trim();
    const name = document.getElementById("adminAirportUpdateName").value.trim();
    const city = document.getElementById("adminAirportUpdateCity").value.trim();
    const country = document.getElementById("adminAirportUpdateCountry").value.trim();
    const latVal = document.getElementById("adminAirportUpdateLat").value;
    const lonVal = document.getElementById("adminAirportUpdateLon").value;

    const payload = { id: id };
    if (iata) payload.iata = iata;
    if (name) payload.name = name;
    if (city) payload.city = city;
    if (country) payload.country = country;
    if (latVal) payload.latitude = parseFloat(latVal);
    if (lonVal) payload.longitude = parseFloat(lonVal);

    setLoading(true);
    apiPost('/airport-update', payload)
        .then(resp => {
            showToast(resp.message || "Airport updated.", "success");
            setOutput(
                `<p>Airport updated: <strong>${resp.airport.iata}</strong> ‚Äî ${resp.airport.name}</p>`,
                "Admin: Airport Update"
            );
            preloadIataLists();
        })
        .catch(setError)
        .finally(() => setLoading(false));
}

function adminRouteAdd() {
    const airlineId = parseInt(document.getElementById("adminRouteAddAirlineId").value, 10);
    const srcId = parseInt(document.getElementById("adminRouteAddSrcId").value, 10);
    const dstId = parseInt(document.getElementById("adminRouteAddDstId").value, 10);
    const stopsVal = document.getElementById("adminRouteAddStops").value;
    const stops = stopsVal === "" ? 0 : parseInt(stopsVal, 10);

    if (!airlineId || !srcId || !dstId) {
        setError(new Error("Route Add: airline_id, src_id, and dst_id are required."));
        return;
    }
    setLoading(true);
    apiPost('/route-add', {
        airline_id: airlineId,
        src_id: srcId,
        dst_id: dstId,
        stops: stops
    })
    .then(resp => {
        showToast(resp.message || "Route added.", "success");
        setOutput(
            `<p>Route added: airline_id=${resp.route.airline_id}, src_id=${resp.route.src_id}, dst_id=${resp.route.dst_id}, stops=${resp.route.stops}</p>`,
            "Admin: Route Add"
        );
    })
    .catch(setError)
    .finally(() => setLoading(false));
}

/* ---------- MENU HANDLING ---------- */
document.querySelectorAll('.menu-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const panelName = btn.getAttribute('data-panel');

        document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        const panel = document.getElementById('panel-' + panelName);
        if (panel) panel.classList.add('active');

        document.getElementById("outputTitle").innerText = "Result";
        const out = document.getElementById("output");
        out.classList.add("placeholder");
        out.textContent = "";
    });
});

/* ---------- AUTOCOMPLETE USING DATALISTS ---------- */
function preloadIataLists() {
    // Airlines
    api('/airlines-by-iata')
        .then(data => {
            const list = data.airlines || [];
            const dl = document.getElementById('airlineList');
            dl.innerHTML = "";
            list.forEach(a => {
                if (!a.iata) return;
                const opt = document.createElement('option');
                opt.value = a.iata;
                opt.textContent = `${a.iata} ‚Äî ${a.name || ""}`;
                dl.appendChild(opt);
            });
        })
        .catch(() => { /* ignore */ });

    // Airports
    api('/airports-by-iata')
        .then(data => {
            const list = data.airports || [];
            const dl = document.getElementById('airportList');
            dl.innerHTML = "";
            list.forEach(a => {
                if (!a.iata) return;
                const opt = document.createElement('option');
                opt.value = a.iata;
                opt.textContent = `${a.iata} ‚Äî ${a.name || ""}`;
                dl.appendChild(opt);
            });
        })
        .catch(() => { /* ignore */ });
}

/* ---------- RIPPLE EFFECT ---------- */
function attachRipples() {
    function addRipple(e) {
        const btn = e.currentTarget;
        const rect = btn.getBoundingClientRect();
        const ripple = document.createElement('span');
        const size = Math.max(rect.width, rect.height);
        ripple.className = 'ripple';
        ripple.style.width = ripple.style.height = size + 'px';
        const x = e.clientX - rect.left - size / 2;
        const y = e.clientY - rect.top - size / 2;
        ripple.style.left = x + 'px';
        ripple.style.top = y + 'px';
        btn.appendChild(ripple);
        setTimeout(() => ripple.remove(), 450);
    }

    document.querySelectorAll('.btn, .icon-btn').forEach(btn => {
        btn.addEventListener('click', addRipple);
    });
}

/* ---------- HOVER TILT (OUTPUT CARD) ---------- */
function initTiltCard() {
    const card = document.querySelector('.tilt-card');
    if (!card) return;

    function handleMove(e) {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const midX = rect.width / 2;
        const midY = rect.height / 2;
        const rotateX = ((y - midY) / midY) * -4;
        const rotateY = ((x - midX) / midX) * 4;
        card.style.transform = `perspective(600px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        card.style.boxShadow = '0 18px 40px rgba(15,23,42,0.45)';
    }

    function reset() {
        card.style.transform = 'perspective(600px) rotateX(0deg) rotateY(0deg)';
        card.style.boxShadow = '';
    }

    card.addEventListener('mousemove', handleMove);
    card.addEventListener('mouseleave', reset);
}

/* ---------- INIT ---------- */
document.addEventListener('DOMContentLoaded', () => {
    applyTheme('dark');
    initParticles();
    attachRipples();
    initTiltCard();
    preloadIataLists();

    // auto-uppercase for all IATA inputs
    document.querySelectorAll('.iata-input').forEach(inp => {
        inp.addEventListener('input', () => {
            inp.value = inp.value.toUpperCase();
        });
    });
});
</script>
</body>
</html>
